<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme=""
><head>
  <title>
    Kevin
   
  </title>

 

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.145.0"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta
    name="description"
    content="
      Less is More


    "
  />
  
  
  
  <link
    rel="stylesheet"
    href="/css/main.min.51423ad97099a08f3a20e16d238c13adae76db7dd5e1913789bdc81143ff4cc6.css"
    integrity="sha256-UUI62XCZoI86IOFtI4wTra52233V4ZE3ib3IEUP/TMY="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
    integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="/post/ubuntu_safe/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.d0408165d31a17f17bba83038bf54e86121f85021bdf936382e636f0f77a952f.js"
    integrity="sha256-0ECBZdMaF/F7uoMDi/VOhhIfhQIb35NjguY28Pd6lS8="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.ea8ebe268922ef9849261a1312cd65b640595e65251ce4c00534a176afd1ac0c.js"
      integrity="sha256-6o6&#43;Joki75hJJhoTEs1ltkBZXmUlHOTABTShdq/RrAw="
      crossorigin="anonymous"
    ></script>

  
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://example.com/images/site-feature-image.png">
  <meta name="twitter:title" content="ubuntu_safe">
  <meta name="twitter:description" content="Less is More">



  


  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "post",
        "name": "ubuntu_safe",
        "headline": "ubuntu_safe",
        "alternativeHeadline": "",
        "description": "
      
        


      


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/example.com\/post\/ubuntu_safe\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Kevin"
        },
        "creator" : {
            "@type": "Person",
            "name": "Kevin"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Kevin"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Kevin"
        },
        "copyrightYear" : "2023",
        "dateCreated": "2023-07-23T21:43:24.00Z",
        "datePublished": "2023-07-23T21:43:24.00Z",
        "dateModified": "2023-07-23T21:43:24.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Kevin",
            "url": "https://example.com/",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/example.com\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
        
        "https://example.com/images/site-feature-image.png"


      
      ]

    ,
        "url" : "https:\/\/example.com\/post\/ubuntu_safe\/",
        "wordCount" : "134",
        "genre" : [ ],
        "keywords" : [ ]
    }
  </script>



</head>
<body>
    <header><div
  class="page-top 
    animated fadeInDown

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
  </a>
  <nav>
    <ul class="nav__list" id="navMenu">
      <div class="nav__links">
        
        
          
          <li>
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/post/"
              
              title=""
              >Posts</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/about/"
              
              title=""
              >About</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/connect/"
              
              title=""
              >Connect</a
            >
          </li>

        
        
      </div>
      <li>
        
          <a class="theme-switch" title="Switch Theme">
            <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
          </a>

        
      </li>
    </ul>
  </nav>
</div>
</header>
    <div class="wrapper">
      <aside><div
  class="sidebar
    animated fadeInDown

  "
>
  <div class="sidebar__content">
    
    
    <div class="logo-title">
      <div class="title">
        <img src="/images/profile.jpg" alt="profile picture" />
        <h3 title=""><a href="/">Kevin</a></h3>
        <div class="description">
          <p>Less is More</p>
        </div>
      </div>
    </div>
    <ul class="social-links">
      
        <li>
          <a href="https://github.com/imkevinliao/imkevinliao.github.io" rel="me" aria-label="GitHub">
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="mailto:im.kevinliao@gmail.com" rel="me" aria-label="e-mail">
            <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer--sidebar">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          2020-2025

        
      </li>
      
        <li class="footer__item">
          <a
            href="/imprint/"
            
            title=""
          >
            imprint
          </a>
        </li>

      
    </ul>
  </div>

</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.44288fd315b6cda68c1f4743caad56535c0f81a5b5a672f385e82b3896575c1d.js"
    integrity="sha256-RCiP0xW2zaaMH0dDyq1WU1wPgaW1pnLzhegrOJZXXB0="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main>
        <div class="autopagerize_page_element">
          <div class="content">

  <div
    class="post 
      animated fadeInDown

    "
  >
    <div class="post-content">
      
      <div class="post-title">
        <h1>ubuntu_safe</h1>
        
          <div class="info">
            <em class="fas fa-calendar-day"></em>
            <span class="date"
              >
                2023/07/23


              </span
            >
            <em class="fas fa-stopwatch"></em>
            <span class="reading-time">One-minute read</span>
          </div>

        
      </div><h1 id="ubuntulinuxunix安全">Ubuntu（Linux|UNIX）安全</h1>
<p>这里特别指出是Ubuntu，市面上很多关于Linux的都是CentOS的，两者在大体上基本一致，但是由于作者本人知识面有限，在本人了解的范围内，这两个操作系统在很多地方还是有细微的差别，正因为他们之间存在一些小小的差异，所以我必须要指出这是一篇关于Ubuntu的安全文档(尽管他们差异很小)。</p>
<p>拓展：Ubuntu是基于Debian发展而来，所以Debian与Ubuntu差异极小；CentOS是Redhat的免费版。如果对Linux有了解的人应该知道，Linux的发行版基本分为两大派系，Debian和Redhat，很多其他名字的Linux发行版本基本都是基于这两大派系演变而来。</p>
<p>UNIX操作系统两大变种：Linux和MacOS，Debian属于Linux发行版，Ubuntu是基于Debian的发行版。所以MacOS与Ubuntu差异，应该可以看得出来。</p>
<p>之所以开篇指出CentOS和Ubuntu，是因为下面说的一些东西在两者上确实有一些区别，但我不想额外指出，所以本文限定在Ubuntu操作系统</p>
<h1 id="超级用户">超级用户</h1>
<p>root作为超级用户，拥有最高的权限，可以执行删除整个操作系统的命令：<code>rm -rf /*</code></p>
<p>一般用户通常是通过sudo来提权执行root操作，事实上如果拥有sudo权限，本质上和root没有任何区别。毕竟，你可以直接修改root用户密码，然后切换到root用户。</p>
<p>通常情况如果我们临时拥有sudo权限，如何偷偷给自己留个后门呢？直接修改root密码，这恐怕是最愚蠢的行为了。</p>
<h2 id="方案一">方案一</h2>
<p>原理（linux系统不是根据用户名来判断root用户，而是通过UID是否等于0来判断的）</p>
<p>基于该原理，我们创建一个用户，然后把UID设置未0那不就好了</p>
<p>创建用户并设置密码（注意这里是useradd，而不是adduser）</p>
<ul>
<li><code>useradd kevin</code></li>
<li><code>passwd kevin</code>
adduser会在创建用户的同时，在 /home/ 路径下创建对应的用户名文件夹，既然我们要偷偷的，那肯定是用useradd命令，因为它只会创建用户，不会做多余的事情。</li>
</ul>
<p>编辑文件设置kevin uid=0，个人习惯vim编辑器，nano或其他文本编辑器都可</p>
<ul>
<li><code>vim /etc/passwd</code></li>
</ul>
<p>找到创建的kevin用户：（实际因人而异，不一定是1001，也可能是其他的，一般Ubuntu操作系统第一个用户Ubuntu是1000，后面创建的依次递增）</p>
<p>kevin&#x274c;1001:1001::/home/kevin:/bin/sh 改成 kevin&#x274c;0:0::/home/kevin:/bin/sh</p>
<p>两个都改成0即可，这样kevin就是root用户了</p>
<p>该方案的问题显而易见，那就是一旦对方熟悉passwd这个文件，一眼便能看到这个奇怪的kevin用户。不过一般来说，以我个人的经验，很少有人能发现，因为大多数人根本不熟悉linux！！！且大家都忙着干活，哪有时间看这玩意。</p>
<h2 id="方案二">方案二</h2>
<p>原理（一般用户都是通过sudo来管理root权限的，既然如此，那我们自己偷偷整个sudo账户不就好了吗）</p>
<p>sudo 文件有/etc/sudoers这个文件，还有/etc/sudoers.d/ 目录下的所有文件</p>
<p>visudo 命令就可以直接打开/etc/sudoers这个文件，我们可以在文件最后一行看到这样一段注释：
<code>#includedir /etc/sudoers.d</code></p>
<p>注意：这里虽然以#开头，表明是注释，但是实际上它是生效的，这应该只是一个提示。</p>
<p>我们既然要偷偷的，那么直接编辑sudoers这个文件就显得不那么明智，我们在/etc/sudoers.d/目录下创建一个文件，然后写入这么一行内容：</p>
<p><code>kevin ALL=(ALL) NOPASSWD:ALL</code></p>
<p>这里说明下NOPASSWD:ALL，这个可以让我们在使用sudo时候免去输入kevin账户密码的繁琐步骤，请确保使用sudo时候明确知道自己在干什么，不要做<code>sudo rm -rf /*</code>这样的事情</p>
<h2 id="方案三">方案三</h2>
<p>原理（使用系统默认组权限）这个理解起来比先前麻烦一些</p>
<p>我们使用id命令查看一下用户kevin <code>id kevin</code>，会得到下面的结果(因人而异)：uid=1001(kevin) gid=1001(kevin) groups=1001(kevin)</p>
<p>我们可以看到有一个 groups ，这个就是我们所谓的组。你可以理解为sudo是一个组，而所有属于sudo组的用户都拥有这个权限。解释不一定到位，自行理解。</p>
<p><code>usermod -a -G sudo kevin</code></p>
<p>将用户kevin追加到sudo用户组中，注意这里使用 -a 表示将kevin用户加入sudo用户组，一个用户可能在很多个用户组中，如果不使用 -a 命令，则会使得该用户只属于sudo用户组，一般我们追加即可。</p>
<p>这种方式较为隐秘，因为直接查看 /etc/sudoers.d 或者 /etc/sudoers 看不到kevin用户，并且在 /etc/passwd 中也是正常用户，没有什么异常，但是kevin已经拥有了sudo权限</p>
<p>ubuntu中sudo对应的是27</p>
<p>我们可以查看下group文件：<code>cat /etc/group</code>，可以看到 kevin 在 sudo 那一行里面。也可以通过命令 <code>getent group sudo</code> 查看。</p>
<h2 id="总结">总结</h2>
<p>作为root管理员需要检查这些文件：（观察是否存在可疑用户）</p>
<p>/etc/passwd</p>
<p>/etc/sudoers</p>
<p>/etc/group</p>
<p>一般可以通过创建用户，然后设置UID为0-499中某一个合适的值，最好用户名也伪装成类似系统用户，这样可以迷惑大部分非专业人员，通常一般人不会去动系统核心的东西。然后再配合其他手段获取sudo权限。</p>
<p>一般而言使用方案三比较难被发现</p>
<h1 id="ssh连接安全">SSH连接安全</h1>
<p>/etc/ssh/sshd_config</p>
<p>编辑该文件，这一部分需要详细了解可以去查看其他相关资料，这里只提关键的部分，以及注意修改配置文件后需要重启sshd服务 <code>sudo systemctl restart sshd</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PermitRootLogin yes
</span></span><span class="line"><span class="cl">PermitRootLogin no
</span></span><span class="line"><span class="cl">PermitRootLogin prohibit-password
</span></span><span class="line"><span class="cl">对于 PermitRootLogin 参数的设置 yes和no 意义都很明确，允许和不允许root用户登录
</span></span><span class="line"><span class="cl">这里我主要想解释下prohibit-password，这个代表不允许root用户密码登录，但是可以使用密钥登录
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Port 22
</span></span><span class="line"><span class="cl">通常22默认是ssh端口，有些时候我们会发现服务器经常被人尝试登录22端口，我们可以考虑换其他端口，虽然意义不大，但是当黑客发现你ssh端口非正常的22端口时候，他心里一定会想，事情开始变得有趣起来了。
</span></span><span class="line"><span class="cl">linux新手就不要修改这个了
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PasswordAuthentication yes
</span></span><span class="line"><span class="cl">是否使用密码认证，设置为no不使用密码认证，转而使用密钥登录更安全
</span></span><span class="line"><span class="cl">这里必须指出，请先验证密钥登录正常再修改这个，否则万一密钥无法登录，然后又不允许密码登录，那就难搞
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PermitEmptyPasswords no
</span></span><span class="line"><span class="cl">是否允许空密码用户登录，建议不允许
</span></span></code></pre></div><p>通常，我们会禁止root权限用户直接登录，只使用普通用户登录。设想这样一个场景，我们购买的服务器开启了ssh端口，黑客会通过暴力或其他方式远程登录到我们的服务器，如果我们只允许普通用户登录，那么即使黑客登陆到了服务器，他能做的事情也非常有限，他必须再想办法做一次提权操作，才能获得服务器完整权限。如果一开始就可以以root身份登录，那么将直接获取服务器所有权限，这显然更危险。</p>
<p>所以禁止root用户登录，然后使用ssh密钥登录，最后关闭允许密码认证，确保服务器安全。</p>
<p>最后再次强调，修改配置文件后一定要重启sshd服务器，不然等于没改。</p>
<h1 id="附录">附录</h1>
<p>查看是否拥有sudo权限，看输出提示 <code>sudo -v</code></p>
<p>直接编辑sudo文件 <code>visudo</code></p>
</div>
    <div class="post-footer">
      <div class="info">
        

        
      </div>
    </div>

    
  </div>


          </div>
        </div>
      </main>
    </div><footer class="footer footer--base">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          2020-2025

        
      </li>
      
        <li class="footer__item">
          <a
            href="/imprint/"
            
            title=""
          >
            imprint
          </a>
        </li>

      
    </ul>
  </div>

</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.44288fd315b6cda68c1f4743caad56535c0f81a5b5a672f385e82b3896575c1d.js"
    integrity="sha256-RCiP0xW2zaaMH0dDyq1WU1wPgaW1pnLzhegrOJZXXB0="
    crossorigin="anonymous"
  ></script></body>
</html>
